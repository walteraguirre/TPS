### Combinación de Predicciones del Modelo con la Calificación Promedio de Películas

Luego de entrenar el modelo de filtrado colaborativo mediante factorización matricial, se realiza una etapa de postprocesamiento para refinar las predicciones. Esta fase consiste en combinar la salida personalizada del modelo con la calificación promedio histórica de cada película, generando una predicción más equilibrada y robusta.

El procedimiento consta de los siguientes pasos:

1. **Cálculo de la predicción inicial (`R_hat`):**  
   Se genera la matriz de predicciones de calificaciones multiplicando los embeddings de ítems (`P`) por los embeddings de usuarios (`Q^T`):  
   $$
   \hat{R} = P Q^\top
   $$
   donde \( \hat{R}_{ij} \) representa la predicción del modelo para el ítem \( i \) y el usuario \( j \).

2. **Cálculo de la media por película (\( \mu_i \)):**  
   Para cada ítem (película), se calcula su calificación promedio considerando únicamente las entradas observadas en la matriz original de ratings \( Y \). Es decir, para cada película \( i \), se tiene:  
   $$
   \mu_i = \frac{ \sum_{j: Y_{ij} \neq 0} Y_{ij} }{ \sum_{j} \mathbb{1}[Y_{ij} \neq 0] }
   $$
   donde \( \mathbb{1}[\cdot] \) es la función indicador que vale 1 si el usuario \( j \) calificó la película \( i \), y 0 en caso contrario.

3. **Expansión de la media (\( \mu \)):**  
   Las medias por película se expanden a una matriz del mismo tamaño que \( \hat{R} \), replicando cada \( \mu_i \) a lo largo de todas las columnas (usuarios). Esto permite combinarlas fácilmente con la matriz de predicciones.

4. **Combinación de estimaciones (`R_final`):**  
   Finalmente, se obtiene una predicción híbrida promediando en partes iguales la salida del modelo y la media por película:  
   $$
   R_{\text{final}} = \frac{1}{2} \hat{R} + \frac{1}{2} \mu
   $$
   Esto permite suavizar las predicciones del modelo puro, especialmente cuando existen pocos datos o cuando el modelo presenta cierto sobreajuste.

Este enfoque de combinación es especialmente útil en sistemas de recomendación reales, donde las matrices de calificación suelen estar muy incompletas. Al incorporar una componente basada en popularidad (la media por ítem), se mejora la estabilidad de las predicciones y se compensa la incertidumbre en las regiones con menor densidad de datos.
